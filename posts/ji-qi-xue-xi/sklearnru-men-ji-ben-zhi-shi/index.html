<!DOCTYPE html>
<html lang="chinese (simplified)">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>sklearn入门基本知识 | imba吧
</title>
  <link rel="canonical" href="https://www.imba.pub/posts/ji-qi-xue-xi/sklearnru-men-ji-ben-zhi-shi/index.html">



  <link rel="stylesheet" href="https://www.imba.pub/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://www.imba.pub/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://www.imba.pub/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://www.imba.pub/theme/css/style.css">


<meta name="description" content="sklearn入门基本知识">
</head>

<body>
  <header class="header">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1 class="title"><a href="https://www.imba.pub">imba吧</a></h1>
          <ul class="list-inline">
            <li class="list-inline-item"><a href="http://www.openui.cn" target="_blank">openui</a></li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>sklearn入门基本知识
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2018-10-25T00:00:00+00:00">
        <i class="fa fa-clock-o"></i>
        Thu 25 October 2018
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="https://www.imba.pub/category/ji-qi-xue-xi.html">机器学习</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="https://www.imba.pub/author/openui.html">openui</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="https://www.imba.pub/tag/ji-qi-xue-xi.html">#机器学习</a>,         <a href="https://www.imba.pub/tag/sklearn.html">#sklearn</a>      </li>
    </ul>
  </header>
  <div class="content">
    <ul>
<li>preprocessing.LabelBinarizer 标签二值化</li>
</ul>
<h3>数据标准化</h3>
<ul>
<li>特征值归化</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets.samples_generator</span> <span class="kn">import</span> <span class="n">make_classification</span>


<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">n_redundant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_informative</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">n_clusters_per_class</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">scale</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1">#X = preprocessing.scale(X)#-1到1范围</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">minmax_scale</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># 1. 基于mean和std的标准化</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>


<h3>数据值拆分</h3>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.mode_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">参数</span>
<span class="sd">---</span>
<span class="sd">arrays：样本数组，包含特征向量和标签</span>

<span class="sd">test_size：</span>
<span class="sd">　　float-获得多大比重的测试样本 （默认：0.25）</span>
<span class="sd">　　int - 获得多少个测试样本</span>

<span class="sd">train_size: 同test_size</span>

<span class="sd">random_state:</span>
<span class="sd">　　int - 随机种子（种子固定，实验可复现）</span>
<span class="sd">　　</span>
<span class="sd">shuffle - 是否在分割之前对数据进行洗牌（默认True）</span>

<span class="sd">返回</span>
<span class="sd">---</span>
<span class="sd">分割后的列表，长度=2*len(arrays),</span>
<span class="sd">　　(train-test split)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>


<h3>定义模型</h3>
<div class="highlight"><pre><span></span># 拟合模型
model.fit(X_train, y_train)
# 模型预测
model.predict(X_test)

# 获得这个模型的参数
model.get_params()
# 为模型进行打分
model.score(data_X, data_y) # 线性回归：R square； 分类问题： acc
</pre></div>


<h3>线性回归</h3>
<div class="highlight"><pre><span></span><span class="n">rom</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">linear_model</span> <span class="kn">import</span> <span class="nn">LinearRegression</span>
<span class="c1"># 定义线性回归模型</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">copy_X</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">参数</span>
<span class="sd">---</span>
<span class="sd">    fit_intercept：是否计算截距。False-模型没有截距</span>
<span class="sd">    normalize： 当fit_intercept设置为False时，该参数将被忽略。 如果为真，则回归前的回归系数X将通过减去平均值并除以l2-范数而归一化。</span>
<span class="sd">     n_jobs：指定线程数</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>


<h3>逻辑回归LR</h3>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="c1"># 定义逻辑回归模型</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="err">’</span><span class="n">l2</span><span class="err">’</span><span class="p">,</span> <span class="n">dual</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">fit_intercept</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">intercept_scaling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="err">’</span><span class="n">liblinear</span><span class="err">’</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="err">’</span><span class="n">ovr</span><span class="err">’</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;参数</span>
<span class="sd">---</span>
<span class="sd">    penalty：使用指定正则化项（默认：l2）</span>
<span class="sd">    dual: n_samples &gt; n_features取False（默认）</span>
<span class="sd">    C：正则化强度的反，值越小正则化强度越大</span>
<span class="sd">    n_jobs: 指定线程数</span>
<span class="sd">    random_state：随机数生成器</span>
<span class="sd">    fit_intercept: 是否需要常量</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>


<h3>朴素贝叶斯算法NB</h3>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">naive_bayes</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">naive_bayes</span><span class="o">.</span><span class="n">GaussianNB</span><span class="p">()</span> <span class="c1"># 高斯贝叶斯</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">naive_bayes</span><span class="o">.</span><span class="n">MultinomialNB</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fit_prior</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">class_prior</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">naive_bayes</span><span class="o">.</span><span class="n">BernoulliNB</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">binarize</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fit_prior</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">class_prior</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">文本分类问题常用MultinomialNB</span>
<span class="sd">参数</span>
<span class="sd">---</span>
<span class="sd">    alpha：平滑参数</span>
<span class="sd">    fit_prior：是否要学习类的先验概率；false-使用统一的先验概率</span>
<span class="sd">    class_prior: 是否指定类的先验概率；若指定则不能根据参数调整</span>
<span class="sd">    binarize: 二值化的阈值，若为None，则假设输入由二进制向量组成</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>


<h3>决策树DT</h3>
<div class="highlight"><pre><span></span><span class="n">rom</span> <span class="n">sklearn</span> <span class="kn">import</span> <span class="nn">tree</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="err">’</span><span class="n">gini</span><span class="err">’</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_weight_fraction_leaf</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">max_features</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_leaf_nodes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">min_impurity_decrease</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">min_impurity_split</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
     <span class="n">class_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">presort</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;参数</span>
<span class="sd">---</span>
<span class="sd">    criterion ：特征选择准则gini/entropy</span>
<span class="sd">    max_depth：树的最大深度，None-尽量下分</span>
<span class="sd">    min_samples_split：分裂内部节点，所需要的最小样本树</span>
<span class="sd">    min_samples_leaf：叶子节点所需要的最小样本数</span>
<span class="sd">    max_features: 寻找最优分割点时的最大特征数</span>
<span class="sd">    max_leaf_nodes：优先增长到最大叶子节点数</span>
<span class="sd">    min_impurity_decrease：如果这种分离导致杂质的减少大于或等于这个值，则节点将被拆分。</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>


<h3>支持向量机SVM</h3>
<div class="highlight"><pre><span></span><span class="n">rom</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">svm</span> <span class="kn">import</span> <span class="nn">SVC</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="err">’</span><span class="n">rbf</span><span class="err">’</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="err">’</span><span class="n">auto</span><span class="err">’</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;参数</span>
<span class="sd">---</span>
<span class="sd">    C：误差项的惩罚参数C</span>
<span class="sd">    gamma: 核相关系数。浮点数，If gamma is ‘auto’ then 1/n_features will be used instead.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>


<h3>k近邻算法KNN</h3>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">neighbors</span>
<span class="c1">#定义kNN分类模型</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">neighbors</span><span class="o">.</span><span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 分类</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">neighbors</span><span class="o">.</span><span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 回归</span>
<span class="sd">&quot;&quot;&quot;参数</span>
<span class="sd">---</span>
<span class="sd">    n_neighbors： 使用邻居的数目</span>
<span class="sd">    n_jobs：并行任务数</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>


<h3>多层感知机（神经网络）</h3>
<div class="highlight"><pre><span></span><span class="n">rom</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">neural_network</span> <span class="kn">import</span> <span class="nn">MLPClassifier</span>
<span class="c1"># 定义多层感知机分类算法</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">MLPClassifier</span><span class="p">(</span><span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;参数</span>
<span class="sd">---</span>
<span class="sd">    hidden_layer_sizes: 元祖</span>
<span class="sd">    activation：激活函数</span>
<span class="sd">    solver ：优化算法{‘lbfgs’, ‘sgd’, ‘adam’}</span>
<span class="sd">    alpha：L2惩罚(正则化项)参数。</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>


<h3>模型评估与选择</h3>
<div class="highlight"><pre><span></span><span class="o">*</span> <span class="err">交叉验证</span>  <span class="err">用于特征选择</span> <span class="err">模型选择</span>
<span class="sb">``</span><span class="err">`</span>
    <span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
    <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;参数</span>
<span class="sd">    ---</span>
<span class="sd">        model：拟合数据的模型</span>
<span class="sd">        cv ： k-fold</span>
<span class="sd">        scoring: 打分参数-‘accuracy’、‘f1’、‘precision’、‘recall’ 、‘roc_auc’、&#39;neg_log_loss&#39;等等</span>
<span class="sd">    &quot;&quot;&quot;</span>



    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
    <span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">train_test_split</span>
    <span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
    <span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">cross_val_score</span>

    <span class="c1"># 加载iris数据集</span>
    <span class="n">iris</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_iris</span><span class="p">()</span>
    <span class="c1"># 读取特征</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">data</span>
    <span class="c1"># 读取分类标签</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span>
    <span class="c1"># 定义分类器</span>
    <span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="c1"># 进行交叉验证数据评估, 数据分为5部分, 每次用一部分作为测试集</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">knn</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
    <span class="c1"># 输出5次交叉验证的准确率</span>
    <span class="k">print</span> <span class="n">scores</span>




    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
    <span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">train_test_split</span>
    <span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
    <span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">cross_val_score</span>

    <span class="c1"># 确定knn中k的取值</span>

    <span class="c1"># 加载iris数据集</span>
    <span class="n">iris</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_iris</span><span class="p">()</span>
    <span class="c1"># 读取特征</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">data</span>
    <span class="c1"># 读取分类标签</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span>
    <span class="c1"># 定义knn中k的取值, 0-10</span>
    <span class="n">k_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="c1"># 保存k对应的准确率</span>
    <span class="n">k_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># 计算每个k取值对应的准确率</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_range</span><span class="p">:</span>
        <span class="c1"># 获得knn分类器</span>
        <span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="n">k</span><span class="p">)</span>
        <span class="c1"># 对数据进行交叉验证求准确率</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">knn</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
        <span class="c1"># 保存交叉验证结果的准确率均值</span>
        <span class="n">k_scores</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="kp">mean</span><span class="p">())</span>

    <span class="c1"># 绘制k取不同值时的准确率变化图像</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_range</span><span class="p">,</span> <span class="n">k_scores</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;K Value in KNN&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cross-Validation Mean Accuracy&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="sb">``</span><span class="err">`</span>

<span class="o">*</span> <span class="err">检验曲线</span>
<span class="sb">``</span><span class="err">`</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">validation_curve</span>
<span class="n">train_score</span><span class="p">,</span> <span class="n">test_score</span> <span class="o">=</span> <span class="n">validation_curve</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_range</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;参数</span>
<span class="sd">---</span>
<span class="sd">    model:用于fit和predict的对象</span>
<span class="sd">    X, y: 训练集的特征和标签</span>
<span class="sd">    param_name：将被改变的参数的名字</span>
<span class="sd">    param_range： 参数的改变范围</span>
<span class="sd">    cv：k-fold</span>

<span class="sd">    返回值</span>
<span class="sd">---</span>
<span class="sd">train_score: 训练集得分（array）</span>
<span class="sd">test_score: 验证集得分（array）</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sb">``</span><span class="err">`</span>
</pre></div>


<ul>
<li>随机森林</li>
</ul>
<div class="highlight"><pre><span></span>criterion: ”gini” or “entropy”(default=”gini”)是计算属性的gini(基尼不纯度)还是entropy(信息增益)，来选择最合适的节点。

splitter: ”best” or “random”(default=”best”)随机选择属性还是选择不纯度最大的属性，建议用默认。

max_features: 选择最适属性时划分的特征不能超过此值。

当为整数时，即最大特征数；当为小数时，训练集特征数*小数；

if “auto”, then max_features=sqrt(n_features).

If “sqrt”, thenmax_features=sqrt(n_features).

If “log2”, thenmax_features=log2(n_features).

If None, then max_features=n_features.

max_depth: (default=None)设置树的最大深度，默认为None，这样建树时，会使每一个叶节点只有一个类别，或是达到min_samples_split。

min_samples_split:根据属性划分节点时，每个划分最少的样本数。
min_samples_leaf:叶子节点最少的样本数。

max_leaf_nodes: (default=None)叶子树的最大样本数。

min_weight_fraction_leaf: (default=0) 叶子节点所需要的最小权值

verbose:(default=0) 是否显示任务进程
关于随机森林特有的参数：
n_estimators=10：决策树的个数，越多越好，但是性能就会越差，至少100左右（具体数字忘记从哪里来的了）可以达到可接受的性能和误差率。
bootstrap=True：是否有放回的采样。  
oob_score=False：oob（out of band，带外）数据，即：在某次决策树训练中没有被bootstrap选中的数据。多单个模型的参数训练，我们知道可以用cross validation（cv）来进行，但是特别消耗时间，而且对于随机森林这种情况也没有大的必要，所以就用这个数据对决策树模型进行验证，算是一个简单的交叉验证。性能消耗小，但是效果不错。  

n_jobs=1：并行job个数。这个在ensemble算法中非常重要，尤其是bagging（而非boosting，因为boosting的每次迭代之间有影响，所以很难进行并行化），因为可以并行从而提高性能。1=不并行；n：n个并行；-1：CPU有多少core，就启动多少job

warm_start=False：热启动，决定是否使用上次调用该类的结果然后增加新的。  

class_weight=None：各个label的权重。  


进行预测可以有几种形式：
predict_proba(x)：给出带有概率值的结果。每个点在所有label的概率和为1.  

predict(x)：直接给出预测结果。内部还是调用的predict_proba()，根据概率的结果看哪个类型的预测值最高就是哪个类型。  

predict_log_proba(x)：和predict_proba基本上一样，只是把结果给做了log()处理。  
</pre></div>


<h3>保存模型</h3>
<ul>
<li>保存为pickle文件</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1"># 保存模型</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;model.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="c1"># 读取模型</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;model.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>


<ul>
<li>sklearn自带方法joblib</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.externals</span> <span class="kn">import</span> <span class="n">joblib</span>

<span class="c1"># 保存模型</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;model.pickle&#39;</span><span class="p">)</span>

<span class="c1">#载入模型</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;model.pickle&#39;</span><span class="p">)</span>
</pre></div>
  </div>

  <div class='zanshang'>
      <button id='showpay'>赏</button>
       <div id="payContent" class="payContent">

           <div><img src='/theme/images/weixinpay.png'><br>微信扫一扫</div>
           <div><img src='/theme/images/alipay.png'><br>支付宝扫一扫</div>

         </div>
   </div>
</article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
          <li class="list-inline-item"><a href="https://www.imba.pub/authors.html">Authors</a></li>
          <li class="list-inline-item"><a href="https://www.imba.pub/archives.html">Archives</a></li>
          <li class="list-inline-item"><a href="https://www.imba.pub/categories.html">Categories</a></li>
          <li class="list-inline-item"><a href="https://www.imba.pub/tags.html">Tags</a></li>
        </ul>
        <p class="col-sm-6 text-sm-right text-muted">
          Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
        </p>
      </div>
    </div>
  </footer>
</body>

</html>