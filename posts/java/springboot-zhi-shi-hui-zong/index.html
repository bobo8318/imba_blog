<!DOCTYPE html>
<html lang="chinese (simplified)">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>springboot 知识汇总 | imba吧
</title>
  <link rel="canonical" href="https://www.imba.pub/posts/java/springboot-zhi-shi-hui-zong/index.html">



  <link rel="stylesheet" href="https://www.imba.pub/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://www.imba.pub/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://www.imba.pub/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://www.imba.pub/theme/css/style.css">


<meta name="description" content="springboot 知识记录">
</head>

<body>
  <header class="header">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1 class="title"><a href="https://www.imba.pub">imba吧</a></h1>
          <ul class="list-inline">
            <li class="list-inline-item"><a href="http://www.openui.cn" target="_blank">openui</a></li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>springboot 知识汇总
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2019-09-22T00:00:00+00:00">
        <i class="fa fa-clock-o"></i>
        Sun 22 September 2019
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="https://www.imba.pub/category/java.html">java</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="https://www.imba.pub/author/openui.html">openui</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="https://www.imba.pub/tag/springboot.html">#springboot</a>,         <a href="https://www.imba.pub/tag/mybatis.html">#mybatis</a>      </li>
    </ul>
  </header>
  <div class="content">
    <h3>springboot</h3>
<ul>
<li>
<p>mybatis</p>
</li>
<li>
<p>mybatis plus mybatis增强工具</p>
<p>```
// 实体类
@Data
@TableName(value = "user")
public class User{
    @TableField(value = "age")
    private Integer userAge;
}</p>
<p>// mapper
@mapper
public interface Usermapper extends BaseMapper<User>{</p>
<p>}</p>
<p>// 分页
@Bean
public PaginationInterceptor paginationInterceptor(){
    return new PaginationInterceptor();
}
```</p>
</li>
<li>
<p>pagehelper :分页工具</p>
<blockquote>
<p>compile('com.github.pagehelper:pagehelper-spring-boot-starter:1.2.3')</p>
</blockquote>
<ul>
<li>properties</li>
</ul>
<p><code>pagehelper.helperDialect=mysql
  pagehelper.reasonable=true
  pagehelper.supportMethodsArguments=true
  pagehelper.params=count=countSql
  pagehelper.page-size-zero=true</code></p>
<ul>
<li>参数说明</li>
</ul>
<p><code>//当前页
  private int pageNum;
  //每页的数量
  private int pageSize;
  //当前页的数量
  private int size;
  //当前页面第一个元素在数据库中的行号
  private int startRow;
  //当前页面最后一个元素在数据库中的行号
  private int endRow;
  //总记录数
  private long total;
  //总页数
  private int pages;
  //结果集
  private List&lt;T&gt; list;
  //第一页
  private int firstPage;
  //前一页
  private int prePage;
  //是否为第一页
  private boolean isFirstPage;
  //是否为最后一页
  private boolean isLastPage;
  //是否有前一页
  private boolean hasPreviousPage;
  //是否有下一页
  private boolean hasNextPage;
  //导航页码数
  private int navigatePages;
  //所有导航页号
  private int[] navigatepageNums;</code></p>
<ul>
<li>
<p>使用</p>
<p><code>PageHelper.startPage(page, size);
List&lt;UserInfo&gt; userInfoList = userInfoMapper.selectAll();
PageInfo&lt;UserInfo&gt; pageInfo = new PageInfo&lt;&gt;(userInfoList);</code></p>
</li>
</ul>
</li>
</ul>
<p>​        </p>
<ul>
<li>test:spring-boot-starter-test</li>
</ul>
<p><code>@RunWith(SpringRunner.class)
  @SpringBootTest</code></p>
<ul>
<li>
<p>mockmvc</p>
<p>```
 @AutoConfigureMockMvc</p>
<p>@MockBean //  @MockBean 会将mock的bean替换掉 SpringBoot 管理的原生bean，从而达到mock的效果。
  private XXXDao xxxtDao;</p>
<p>Mockito.when(
        xxxDao.findMapBySql(
                Mockito.anyString(),Mockito.anyList()
        )
 ).thenReturn(dataList);</p>
<p>// http请求</p>
<p>//配置MockMvc
@Autowired
protected MockMvc mockMvc;
@Test
public void TestXXX() throws Exception {
       MvcResult result = mockMvc.perform(
                MockMvcRequestBuilders.get("/xxxController/xxx_query")
                        .contentType(MediaType.APPLICATION_JSON_UTF8)    <br>
                        .param("xxx","xxx")</p>
<div class="highlight"><pre><span></span>            )
            .andExpect(MockMvcResultMatchers.status().isOk())
            .andDo(MockMvcResultHandlers.print())
            .andReturn();

}
</pre></div>


<p>｝
//静态导入 简化
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.<em>;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.</em>;</p>
<p>String content = "{\"username\":\"pj_mike\",\"password\":\"123456\"}";
mockMvc.perform(request(HttpMethod.POST, "/user")
        .contentType("application/json").content(content))
        .andExpect(status().isOk())
        .andExpect(content().string("ok"));</p>
<p>```</p>
<table>
<thead>
<tr>
<th>.perform()</th>
<th>执行一个MockMvcRequestBuilders请求。其中<code>.get()</code>表示发送get请求（可以使用get、post、put、delete等）；<code>.contentType()</code>设置编码格式；<code>.param()</code>请求参数,可以带多个。</th>
</tr>
</thead>
<tbody>
<tr>
<td>andExpect()</td>
<td>加 MockMvcResultMatchers验证规则，验证执行结果是否正确</td>
</tr>
<tr>
<td>.andDo()</td>
<td>添加 MockMvcResultHandlers结果处理器,这是可以用于打印结果输出。</td>
</tr>
<tr>
<td>.andReturn()</td>
<td>结果还回，然后可以进行下一步的处理。</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>单元测试的时候，如果不想造成垃圾数据，可以开启事务功能，在方法或类头部添加 @Transactional 注解即可</p>
</li>
<li>
<p>真实Web环境进行测试</p>
<p>```
@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class UserControllerTest3 {
  @Autowired
  private TestRestTemplate testRestTemplate;//RestTemplate的一种替代品
  @Test
  public void userMapping() throws Exception {
    User user = new User();
    user.setUsername("pj_pj");
    user.setPassword("123456");
    ResponseEntity<String> responseEntity = testRestTemplate.postForEntity("/user", user, String.class);
    System.out.println("Result: "+responseEntity.getBody());
    System.out.println("状态码: "+responseEntity.getStatusCodeValue());
  }
}</p>
<p>MultiValueMap,StringUtils,HttpEntity,ResponseEntity
```</p>
</li>
</ul>
  </div>

  <div class='zanshang'>
      <button id='showpay'>赏</button>
       <div id="payContent" class="payContent">

           <div><img src='/theme/images/weixinpay.png'><br>微信扫一扫</div>
           <div><img src='/theme/images/alipay.png'><br>支付宝扫一扫</div>

         </div>
   </div>
</article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
          <li class="list-inline-item"><a href="https://www.imba.pub/authors.html">Authors</a></li>
          <li class="list-inline-item"><a href="https://www.imba.pub/archives.html">Archives</a></li>
          <li class="list-inline-item"><a href="https://www.imba.pub/categories.html">Categories</a></li>
          <li class="list-inline-item"><a href="https://www.imba.pub/tags.html">Tags</a></li>
        </ul>
        <p class="col-sm-6 text-sm-right text-muted">
          Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
        </p>
      </div>
    </div>
  </footer>
</body>

</html>