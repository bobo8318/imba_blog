(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{445:function(t,s,a){"use strict";a.r(s);var r=a(43),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"docker-下部署-gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-下部署-gitlab"}},[t._v("#")]),t._v(" docker 下部署 gitlab")]),t._v(" "),a("h3",{attrs:{id:"docker-下部署-gitlab-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-下部署-gitlab-2"}},[t._v("#")]),t._v(" docker 下部署 gitlab")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("下载镜像")]),t._v(" "),a("blockquote",[a("p",[t._v("docker pull gitlab/gitlab-ce")])])]),t._v(" "),a("li",[a("p",[t._v("运行镜像")]),t._v(" "),a("blockquote",[a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[t._v(" docker run "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("222")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name gitlab "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("restart always "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab gitlab"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ce\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])])]),t._v(" "),a("li",[a("p",[t._v("配置")]),t._v(" "),a("blockquote",[a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[t._v("vim "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitlab"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rb\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置http协议所使用的访问地址,不加端口号默认为80")]),t._v("\nexternal_url "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://192.168.199.231'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置ssh协议所使用的访问地址和端口")]),t._v("\ngitlab_rails"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab_ssh_host'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.199.231'")]),t._v("\ngitlab_rails"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab_shell_ssh_port'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("222")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此端口是run时22端口映射的222端口")]),t._v("\n\ndocker restart gitlab\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])])])]),t._v(" "),a("li",[a("p",[t._v("使用")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("客户端配置ssh")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("windows")]),t._v(" "),a("blockquote",[a("p",[t._v("//设置用户信息")]),t._v(" "),a("p",[t._v("git config --global "),a("a",{attrs:{href:"http://user.name",target:"_blank",rel:"noopener noreferrer"}},[t._v("user.name"),a("OutboundLink")],1),t._v(' "hanzichi" //给自己起个用户名\ngit config --global user.email '),a("a",{attrs:{href:"http://mailto:%22abc@gmail.com",target:"_blank",rel:"noopener noreferrer"}},[t._v('"abc@gmail.com'),a("OutboundLink")],1),t._v('" //填写自己的邮箱')]),t._v(" "),a("p",[t._v("//生成秘钥")]),t._v(" "),a("p",[t._v('ssh-keygen -t rsa -C "'),a("a",{attrs:{href:"https://link.jianshu.com/?t=mailto:yourEmail@example.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("yourEmail@example.com"),a("OutboundLink")],1),t._v('"')])])])])]),t._v(" "),a("li",[a("p",[t._v("本地上传仓库")]),t._v(" "),a("blockquote",[a("p",[t._v("git init")]),t._v(" "),a("p",[t._v("git remote add origin ****")]),t._v(" "),a("p",[t._v("git add .")]),t._v(" "),a("p",[t._v('git commit -m "first init"')]),t._v(" "),a("p",[t._v("git push -u origin master")])])]),t._v(" "),a("li",[a("p",[t._v("下载仓库")]),t._v(" "),a("blockquote",[a("p",[t._v("git clone git@ip:test/website.git")]),t._v(" "),a("p",[t._v("cd website")]),t._v(" "),a("p",[t._v("touch README.md")]),t._v(" "),a("p",[t._v("git add README.md")]),t._v(" "),a("p",[t._v('git commit -m "add readme"')]),t._v(" "),a("p",[t._v("git push -u origin master")])])]),t._v(" "),a("li",[a("p",[t._v("已有仓库")]),t._v(" "),a("blockquote",[a("p",[t._v("git remote rename origin old-origin")]),t._v(" "),a("p",[t._v("git remote add origin ****")]),t._v(" "),a("p",[t._v("git push -u origin  --all")]),t._v(" "),a("p",[t._v("git push -u origin -- tags")])])]),t._v(" "),a("li",[a("p",[t._v("每日定时（win）")]),t._v(" "),a("blockquote",[a("p",[t._v("//bat 文件内容")]),t._v(" "),a("p",[t._v("@echo off\n@title bat 交互执行git命令\nD:\ncd D:/git/test\ngit add .\ngit commit -m %date:~0,4%年%date:~5,2%月%date:~8,2%日")]),t._v(" "),a("p",[t._v("git push -u origin master")]),t._v(" "),a("p",[t._v("加入到计划任务里即可")])])])])]),t._v(" "),a("li",[a("p",[t._v("遇到的问题")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("external_url设置问题：不能带端口")])]),t._v(" "),a("li",[a("p",[t._v("Whoops, GitLab is taking too much time to respond：比较耗内存 需要多等会")]),t._v(" "),a("blockquote",[a("p",[t._v("free -m  查看内存使用情况 如果一直在减少证明还在开启中")])])]),t._v(" "),a("li",[a("p",[t._v("22端口占用：系统默认22端口被ssh占用，需要释放出来。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("修改ssh端口")]),t._v(" "),a("blockquote",[a("p",[t._v("semanage port -l|grep ssh //查看端口使用情况")]),t._v(" "),a("p",[t._v("vim /etc/ssh/sshd_config  //修改配置文件 注意 是sshd 不是ssh")]),t._v(" "),a("p",[t._v("把其中的#Port 22 修改")]),t._v(" "),a("p",[t._v("semanage port -a -t ssh_port_t -p tcp 12345  //给SELinux增加设置的端口")]),t._v(" "),a("p",[t._v("systemctl restart sshd.service //重启服务")])])])])]),t._v(" "),a("li",[a("p",[t._v("The file will have its original line endings in your working directory.")]),t._v(" "),a("blockquote",[a("p",[t._v("git config --global core.autocrlf false")])])]),t._v(" "),a("li",[a("p",[t._v("已运行容器修改端口")]),t._v(" "),a("blockquote",[a("p",[t._v("1、获得容器IP")]),t._v(" "),a("p",[t._v("docker inspect "),a("code",[t._v("container_name")]),t._v(" | grep IPAddress")]),t._v(" "),a("p",[t._v("2、iptable转发端口")]),t._v(" "),a("p",[t._v("iptables -t nat -A  DOCKER -p tcp --dport 60000 -j DNAT --to-destination 172.17.0.2:22")]),t._v(" "),a("p",[t._v("客户端需要在～/.ssh/config 文件中添加 Host 14.152.10.7 Port 60000")]),t._v(" "),a("p",[t._v("然后需要重新生成秘要上传")])])])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);