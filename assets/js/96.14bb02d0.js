(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{439:function(n,s,t){"use strict";t.r(s);var a=t(43),e=Object(a.a)({},(function(){var n=this,s=n.$createElement,t=n._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h1",{attrs:{id:"shiro"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shiro"}},[n._v("#")]),n._v(" shiro")]),n._v(" "),t("h3",{attrs:{id:"核心组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#核心组件"}},[n._v("#")]),n._v(" 核心组件")]),n._v(" "),t("ul",[t("li",[t("p",[n._v("Subject:当前操作主体")])]),n._v(" "),t("li",[t("p",[n._v("SecurityManager:安全管理器")])]),n._v(" "),t("li",[t("p",[n._v("Realm:应用与数据安全的桥梁")])])]),n._v(" "),t("h3",{attrs:{id:"spring-boot-引入shiro"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot-引入shiro"}},[n._v("#")]),n._v(" spring boot 引入shiro")]),n._v(" "),t("ul",[t("li",[t("p",[n._v("依赖")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("<dependency>\n    <groupId>org.apache.shiro</groupId>\n    <artifactId>shiro-spring</artifactId>\n    <version>1.4.0</version>\n</dependency>\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br")])])]),n._v(" "),t("li",[t("p",[n._v("配置类")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('@Configuration\npublic class ShiroConfig{\n  \n\t@Bean\n\tpublic ShiroFilterFactoryBean shiroFiler(@Qualifier("securityManager") SecurityManager securityManager){\n\t\tShiroFilterFactoryBean filter = new ShiroFilterFactoryBean()\n\t\tfilter.setSecurityManager(securityManager)\n\t\t/**\n\t\t* shiro 内置过滤器\n\t\t*\tanon:无需认证\n\t\t\tauthc:必须认证才能访问\n\t\t\tuser:使用remember me 可以访问\n\t\t\tperms:　该资源必须得到资源权限才可以访问\n\t\t\trole:该资源必须得到角色\n\t\t**/\n\t\t\n\t\tMap<String, String> filterMap = new LinkedHashMap<String, String>();\n\t\t\n\t\t//filterMap.put("/*", "authc");\n\t\tfilterMap.put("/add", "authc");\n\t\tfilterMap.put("/update", "authc");\n\t\t//filterMap.put("/login", "anon");\n\t\tfilter.setLoginUrl("/login")\n\t\tfilter.setFilterChainDefinitionMap(filterMap)\n\t\t// 授权过滤器 拦截后默认会自动跳转到未授权页面401\n\t\tfilterMap.put("/add", "perms[user:add]");\n\t\t// 设置未授权页面\n\t\tfilter.setUnauthorizedUrl("/unAuth")\n\t\treturn filter;\n\t}\n\t\n\t@Bean(name="")\n\tpublic SecurityManager securityManager(@Qualifier("userRealm") UserRealm realm){\n\t\tDefaultWebSecurityManager manager = new DefaultWebSecurityManager();\n\t\tmanager.setRealm(realm)\n\t\treturn manager;\n\t}\n\t\n\t@Bean(name="")\n\tpublic UserRealm getUserRealm(){\n\t\treturn new UserRealm();\n\t}\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br"),t("span",{staticClass:"line-number"},[n._v("40")]),t("br"),t("span",{staticClass:"line-number"},[n._v("41")]),t("br"),t("span",{staticClass:"line-number"},[n._v("42")]),t("br"),t("span",{staticClass:"line-number"},[n._v("43")]),t("br")])]),t("ul",[t("li",[t("p",[n._v("UserRealm.class")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('public class UserRealm extends AuthorizingRealm{\n\t\n\t@AutoWired\n\tprivate UserService userService\n\n\t//认证逻辑\n\t@Overwrite\n\tprotected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken arg0){\n\t\t// \n\t\t\n\t\tUsernamePasswordToken token = (UsernamePasswordToken)arg0;\n\t\t\n\t\tUserPo user = userService.getUser(token.getUsername())\n\t\t\n\t\tif(!token.getUsername().equals(name))(//　用户不存在\n\t\t\treturn null;//底层会抛出UnKnownAccountException\n\t\t)\n\t\treturn new SimpleAuthenticationInfo("", token.getPassword(), "");\n\t}\n\t//授权逻辑\n\t@Overwrite\n\tprotected AuthenticationInfo doGetAuthenticationInfo(PrincipalCollection pc){\n\t\tString username = (String) pc.getPrimaryPrincipal();\n\t\tUser user = new User();\n\t\tuser.serUsername(username);\n\t\tSimpleAuthenticationInfo info = new SimpleAuthenticationInfo();\n\t\tinfo.addStringPermission("delete");\n\t\tList roleList = userService.getRole(user);\n\t\tif(roleList != null){\n\t\t\tfor(String role : roleList){\n\t\t\t\tinfo.addRole(role);\n\t\t\t}\n\t\t\treturn info;\n\t\t}\n\t\treturn null;\n\t}\n\t\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br")])])]),n._v(" "),t("li",[t("p",[n._v("LoginController")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('@RequestMapping("/login")\npublic String doLogin(String username, String password){\n\t//　获取subject类\n\tSubject subject = SecurityUtils.getSubject();\n\t// 封装用户数据\n\tUsernamePasswordToken token = new UsernamePasswordToken(username, password);\n\ttry{\n\t\t// 执行登陆逻辑\n\t\tsubject.login(token);\n\t}catch(){\n\t\t\n\t}\n\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br")])])]),n._v(" "),t("li",[t("p",[n._v("controller添加")]),n._v(" "),t("blockquote",[t("p",[n._v('@RequiresPermissions("user:add")')]),n._v(" "),t("p",[n._v("//编程方式")]),n._v(" "),t("p",[n._v("Subject subject = SecurityUtils.getSubject();")]),n._v(" "),t("p",[n._v('if(subject.hasRole("admin")){')]),n._v(" "),t("p",[n._v("​\t//有权限")]),n._v(" "),t("p",[n._v("}")])])]),n._v(" "),t("li",[t("p",[n._v('@RequiresPermissions("user:add")')]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('/**\n* 注解支持\n*/\n\n@Bean\n@ConditionalOnMissingBean\npublic DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator(){\n  DefaultAdvisorAutoProxyCreator aas = new DefaultAdvisorAutoProxyCreator();\n  aas.setProxyTargetClass(true);\n  return aas;\n}\n\n@Bean\n@ConditionalOnMissingBean\npublic AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(@Qualifier("securityManager") SecurityManager securityManager){\n  AuthorizationAttributeSourceAdvisor aas = new AuthorizationAttributeSourceAdvisor();\n  aas.setSecurityManager(securityManager);\n  return aas;\n}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br")])])]),n._v(" "),t("li",[t("p",[n._v("md5 encode password + salt")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code")]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"})])])]),n._v(" "),t("p",[n._v("//save md5 password\nString password = admin.getPassword();\nString salt = RandomStringUtils.randomNumeric(6,8);\nMd5Hash md5hash = new Md5Hash(password, salt);//encode 1\nadmin.setPassword(md5hash.toString());")]),n._v(" "),t("p",[n._v('//config macher bean\n@Bean //md5 encode pwd ma\npublic CredentialsMatcher credentialsMatcher(){\nHashedCredentialsMatcher macher = new HashedCredentialsMatcher();\nmacher.setHashAlgorithmName("md5");\nreturn  macher;\n}')]),n._v(" "),t("p",[n._v("// shiroconfig.java use when realm doGetAuthenticationInfo")]),n._v(" "),t("p",[n._v("#in get realm methon\nUserRealm realm =  new UserRealm();\n//realm.setCredentialsMatcher(credentialsMatcher());\nreturn realm;")]),n._v(" "),t("p",[n._v("#in doGetAuthenticationInfo method\nByteSource bsSalt = new SimpleByteSource(user.getSalt());\nSimpleAuthenticationInfo authenticationInfo = new SimpleAuthenticationInfo(user, user.getUserpwd(),bsSalt,getName());")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('\n\n\n* thymeleaf & shiro\n\n* impoty thymeleaf\n\n  ```\n  com.github.theborakompanioni\n  thtmeleaf-extras-shiro\n  2.0.0\n  ```\n\n* ShiroConfig 添加　ShiroDialect\n\n  ```\n  @Bean\n  public ShiroDialect getShiroDialect(){\n  \treturn new ShiroDialect();\n  }\n  ```\n\n* 使用\n\n  ```\n  <div　shiro:hasPermission="user:add">添加</div>\n  <div　shiro:hasPermission name"add">添加</div>\n  <div　shiro:hasAnyRoles name="user">添加</div>\n  ```\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);